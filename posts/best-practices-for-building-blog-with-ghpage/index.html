<!doctype html><html><head><title>Github Pages搭建个人博客的最佳实践&nbsp;- Libre's Blog</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/vendor/js/jquery.min.js></script><script src=/vendor/js/popper.min.js></script><script src=/vendor/js/bootstrap.min.js></script><script src=/vendor/js/smooth-scroll.polyfills.min.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><script src=/vendor/js/vue.min.js></script><link rel=stylesheet href=https://www.libre.fun/scss/journal.min.8650853483769a2c86962bebf88e58771fef8dc8b1690fe91be762e7a85085f6.css integrity="sha256-hlCFNIN2miyGlivr+I5Ydx/vjcixaQ/pG+di56hQhfY=" media=screen><script src=https://www.libre.fun//js/loadCSS.js></script><script src=https://www.libre.fun//js/table.js></script><script src=https://www.libre.fun//js/toc.js></script><script>loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script src=/vendor/js/md5.min.js></script><script>const gitalk=new Gitalk({clientID:'76eb2ff425beb8b7d1e2',clientSecret:'8c86c664d1d2dc6034544b9b679a19bd3507a84d',repo:'blog',owner:'ffffansz',admin:['ffffansz'],id:md5(location.pathname),});window.onload=function(){gitalk.render('gitalk-container')}</script></head><body><div id=app><div ref=sideContainer class=side-container><a class="a-block nav-head false" href=https://www.libre.fun/><div class=nav-title>Libre's Blog</div><div class=nav-subtitle>理想是，以代码安身，以文字立命</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>文章</a>
<a class="a-block nav-link-item false" href=/tags>标签</a>
<a class="a-block nav-link-item false" href=/about>关于</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://amazingrise.net>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal</a><br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> and <a href=https://pages.github.com/ target=_blank>Github Pages</a><br><br>&copy;
Libre. 本站遵循 CC-BY-NC 4.0 协议<br><a href=https://github.com/ffffansz/blog/blob/master/CHANGELOG.md target=_blank>CHANGELOG</a></div></div><div ref=extraContainer class=extra-container><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e5%bc%95%e8%a8%80 v-on:click=closeDrawer id=引言-nav>引言</a></li></ul></ul><ul><ul><li><a href=#github-pages%e5%8f%91%e5%b8%83%e5%86%85%e5%ae%b9%e7%9a%84%e5%87%a0%e7%a7%8d%e6%96%b9%e5%bc%8f v-on:click=closeDrawer id=github-pages发布内容的几种方式-nav>Github Pages发布内容的几种方式</a></li></ul></ul><ul><ul><li><a href=#%e5%88%86%e7%a6%bb%e5%8d%9a%e5%ae%a2%e6%ba%90%e7%a0%81%e5%92%8c%e5%86%85%e5%ae%b9 v-on:click=closeDrawer id=分离博客源码和内容-nav>分离博客源码和内容</a></li></ul></ul><ul><ul><li><a href=#%e5%88%a9%e7%94%a8github-actions%e5%ae%9e%e7%8e%b0cicd v-on:click=closeDrawer id=利用github-actions实现cicd-nav>利用Github Actions实现CI/CD</a></li></ul></ul><ul><ul><li><a href=#%e5%b0%8f%e7%bb%93 v-on:click=closeDrawer id=小结-nav>小结</a></li></ul></ul><ul><ul><li><a href=#troubleshooting v-on:click=closeDrawer id=troubleshooting-nav>Troubleshooting</a></li></ul></ul><ul><ul><ul><li><a href=#%e5%a6%82%e4%bd%95%e8%ae%be%e7%bd%aedevlop_key v-on:click=closeDrawer id=如何设置devlop_key-nav>如何设置devlop_key</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e5%a6%82%e4%bd%95%e8%bf%81%e7%a7%bb v-on:click=closeDrawer id=如何迁移-nav>如何迁移</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e7%a7%81%e6%9c%89%e4%bb%93%e5%ba%93%e5%92%8cgithub-actions%e7%9a%84%e4%bd%bf%e7%94%a8%e6%9c%89%e4%bd%95%e9%99%90%e5%88%b6 v-on:click=closeDrawer id=私有仓库和github-actions的使用有何限制-nav>私有仓库和Github Actions的使用有何限制</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e5%85%b6%e4%bb%96 v-on:click=closeDrawer id=其他-nav>其他</a></li></ul></ul></ul></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a></div></div><div class=single-column-drawer-container ref=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>文章</a>
<a class="a-block drawer-menu-item false" href=/tags>标签</a>
<a class="a-block drawer-menu-item false" href=/about>关于</a><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e5%bc%95%e8%a8%80 v-on:click=closeDrawer id=引言-nav>引言</a></li></ul></ul><ul><ul><li><a href=#github-pages%e5%8f%91%e5%b8%83%e5%86%85%e5%ae%b9%e7%9a%84%e5%87%a0%e7%a7%8d%e6%96%b9%e5%bc%8f v-on:click=closeDrawer id=github-pages发布内容的几种方式-nav>Github Pages发布内容的几种方式</a></li></ul></ul><ul><ul><li><a href=#%e5%88%86%e7%a6%bb%e5%8d%9a%e5%ae%a2%e6%ba%90%e7%a0%81%e5%92%8c%e5%86%85%e5%ae%b9 v-on:click=closeDrawer id=分离博客源码和内容-nav>分离博客源码和内容</a></li></ul></ul><ul><ul><li><a href=#%e5%88%a9%e7%94%a8github-actions%e5%ae%9e%e7%8e%b0cicd v-on:click=closeDrawer id=利用github-actions实现cicd-nav>利用Github Actions实现CI/CD</a></li></ul></ul><ul><ul><li><a href=#%e5%b0%8f%e7%bb%93 v-on:click=closeDrawer id=小结-nav>小结</a></li></ul></ul><ul><ul><li><a href=#troubleshooting v-on:click=closeDrawer id=troubleshooting-nav>Troubleshooting</a></li></ul></ul><ul><ul><ul><li><a href=#%e5%a6%82%e4%bd%95%e8%ae%be%e7%bd%aedevlop_key v-on:click=closeDrawer id=如何设置devlop_key-nav>如何设置devlop_key</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e5%a6%82%e4%bd%95%e8%bf%81%e7%a7%bb v-on:click=closeDrawer id=如何迁移-nav>如何迁移</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e7%a7%81%e6%9c%89%e4%bb%93%e5%ba%93%e5%92%8cgithub-actions%e7%9a%84%e4%bd%bf%e7%94%a8%e6%9c%89%e4%bd%95%e9%99%90%e5%88%b6 v-on:click=closeDrawer id=私有仓库和github-actions的使用有何限制-nav>私有仓库和Github Actions的使用有何限制</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e5%85%b6%e4%bb%96 v-on:click=closeDrawer id=其他-nav>其他</a></li></ul></ul></ul></div></div></div></div></div><transition name=fade><div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav ref=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div ref=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a ref=navTitle class=navbar-brand href=https://www.libre.fun/>Libre's Blog</a></div></nav><div class=single-column-header-container ref=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://www.libre.fun/><div class=single-column-header-title>Libre's Blog</div><div class=single-column-header-subtitle>理想是，以代码安身，以文字立命</div></a></div><div id=content><div ref=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only style="background-image:url('/')"><div class=post-title>Github Pages搭建个人博客的最佳实践<div class=post-meta><time itemprop=datePublished>2020/04/23 15:24</time>
<i class=material-icons>label</i>&nbsp;<a href=/tags/blog>Blog</a></div></div></div><div class=post-body-wrapper><div class=post-body><h2 id=引言>引言</h2><p>前不久使用Hugo重新搭建了自己的站点，利用Github Pages托管，也将整个过程<a href=/posts/build-site-with-hugo-and-github-pages/>记录</a>了下来。其中，利用Github Actions实现CI/CD是我认为非常重要的一环，可以大大简化个人博客的更新流程。</p><p>随着近半个月的使用，我的博客也发生了一些变化。由于要添加评论系统，需要在<code>config.toml</code>中写入一些Secrets，因此我将博客背后的托管逻辑进行了一些修改。</p><p>在修改前，我只使用一个<code>ffffansz/blog</code>仓库，其中<code>master</code>分支包含了源码和仓库的README，而<code>gh-pages</code>分支则用于发布博客内容，该分支利用<a href=https://github.com/peaceiris/actions-gh-pages>peaceiris/actions-gh-pages@v3</a>进行更新，在每次<code>master</code>分支push时触发。</p><p>修改后，仓库变成了两个，一个私有仓库<code>ffffansz/blog-src</code>，一个公有仓库<code>ffffansz/blog</code>。从名称不难想到，<code>blog-src</code>存放博客源码，只有一个<code>master</code>分支；<code>blog</code>仓库仍然具有两个分支，<code>master</code>分支存放README和网站的CHANGELOG，<code>gh-pages</code>分支和之前一样，用于发布Github Pages内容。</p><p>个人认为，这种模式保证了私密信息的安全性，也在展示方面非常优雅。</p><p>如有他人访问你的Github Profile，进入<code>blog</code>仓库，默认展现<code>master</code>分支，只有简单的两个Markdown文件，README可用于放置博客链接和一些文字介绍，CHANGELOG则是你自己记录博客更迭过程的一个日记。另一方面，有一些不便公开的信息，例如某些评论系统的Key，或是Google Analytics的UA号，则被隐藏在自己的私有仓库中。</p><p>本文主要介绍我个人心中利用Github Pages搭建个人博客的最佳实践：Github仓库分布的设计，利用Github Actions实现CI/CD的流程等。也欢迎各位在评论区分享自己的个人博客搭建心得😊。</p><blockquote class="my-alert my-alert-note"><p>本文的讨论不局限于任何特定的静态网站生成器。</p></blockquote><h2 id=github-pages发布内容的几种方式>Github Pages发布内容的几种方式</h2><p>为了进行示例，这里我创建一个名为<code>exampleSite</code>的仓库，并且创建了<code>master</code>和<code>gh-pages</code>两个分支。在Github上进入该仓库的「Setting」页面，有一名为「Github Pages」的模块。其中，点击「Source」下的下拉菜单，可以看到几种Github Pages发布内容的方式。</p><blockquote><p>此处的「内容」，特指静态网站生成器，如Hugo/Hexo/Gitbook等，处理网站源码后生成的用于发布的诸多网页文件。以Hugo为例，运行<code>hugo</code>命令后，会生成<code>public</code>目录。该目录下的文件就是本文所称的「内容」。</p></blockquote><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200423164315.png alt></p><blockquote><p>这里由于仓库包含了<code>gh-pages</code>分支，因此系统默认启用Github Pages并选择了该方式。其他情况下，需要手动启用。</p></blockquote><p>有三种方式：</p><ol><li>发布<code>gh-pages</code>分支下所有内容👍</li><li>发布<code>master</code>分支下所有内容</li><li>发布<code>master</code>分支下<code>/docs</code>目录下所有内容</li></ol><p>本文推荐使用第一种方式。理由在<a href=#%E5%BC%95%E8%A8%80>引言</a>部分已有阐述：仓库首页干净简洁，纷乱的网站内容目录被隐藏到了<code>gh-pages</code>分支下。</p><p>看到这里有读者可能会想到，建立一个<code>blog</code>仓库，使用三个分支：<code>master</code>分支只放<code>README</code>——保证了干净，<code>src</code>分支放网站源码，<code>gh-pages</code>分支放网站内容。</p><p>但是这样一来，网站源码和网站内容，仍然处在同一个仓库内。然而我个人提倡<strong>将二者分离开来</strong>，这就是下一节要讨论的内容。</p><h2 id=分离博客源码和内容>分离博客源码和内容</h2><p>以本站为例子来说明为什么要进行分离。</p><p>起初，博客不具有评论功能。经过比较，我决定使用「<a href=https://github.com/gitalk/gitalk>Gitalk</a>」为博客提供评论系统支持。根据网站使用的框架与主题，需要在网站源码目录的<code>config.toml</code>中，填入以下信息：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gitalk</span>]
  <span style=color:#a6e22e>owner</span> = <span style=color:#e6db74>&#34;&lt;your-github-username&gt;&#34;</span>
  <span style=color:#a6e22e>repo</span> = <span style=color:#e6db74>&#34;&lt;your-repository-used-for-placing-comments&gt;&#34;</span>
  <span style=color:#a6e22e>client_id</span> = <span style=color:#e6db74>&#34;&lt;some_id&gt;&#34;</span>
  <span style=color:#a6e22e>client_secret</span> = <span style=color:#e6db74>&#34;&lt;some_secret&gt;&#34;</span>
</code></pre></div><p>这里的<code>client_secret</code>和<code>client_id</code>我是不愿暴露在公有仓库中的。虽然对于Gitalk而言，即使这两个信息暴露，其他人也无法对你造成什么干扰。但是如果推广到更多情况，我认为总有一些信息是不应当暴露到公有仓库的。</p><p>为了实现源码和内容的分离，我们可以再创建一个<strong>私有仓库</strong>，取名为<code>blog-src</code>。然后将博客源码托管在该仓库内。</p><h2 id=利用github-actions实现cicd>利用Github Actions实现CI/CD</h2><p>CI/CD，意为持续集成/持续部署，是软件工程中的名词。在个人博客搭建这件事上，CI/CD可以实现的效果是：本地新增或修改了一篇文章，推送到<code>blog-src</code>仓库后，可以在较短时间（10分钟以内），自动将博客的改动反映至博客主页上。</p><p>如果不借助Github Actions实现CI/CD，往往我们需要一些手动工作才能更新博客。以Hugo为例，修改过博客的样式或是文章后，我们需要在本地手动执行<code>hugo</code>命令生成<code>public</code>目录，然后将<code>public</code>目录下的内容手动推送至<code>gh-pages</code>分支，或是将<code>public</code>目录名修改为<code>docs</code>（Github Pages的设置则需要修改为方式3），等等，不够省心。</p><p>得益于社区的贡献，目前已有很多开箱即用的Github Actions，本文推荐使用<a href=https://github.com/peaceiris/actions-gh-pages>peaceiris/actions-gh-pages</a>。另外，本网站使用了Hugo作为静态网站生成器，因此还需要<a href=https://github.com/peaceiris/actions-hugo>peaceiris/actions-hugo</a>，以实现本地修改push到仓库后，在线进行博客内容的构建，而省去了本地构建的麻烦。</p><blockquote class="my-alert my-alert-note"><p>对于其他静态网站生成器，也可以在Github上找到对应的Actions；本质上，Github Actions的原理就是在Github的服务端运行容器，然后根据需要抽取出相应的内容。你也可以模仿<a href=https://github.com/peaceiris/actions-hugo>peaceiris/actions-hugo</a>来实现自己所需的Actions。</p></blockquote><p>添加Github Actions的方式很简单，在<strong>博客源码目录</strong>下新建<code>.github/workflows</code>目录，然后在其中建立<code>gh-pages.yml</code>文件，然后按照一定的语法指定Actions，下面给出本站使用的Actions：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>name</span>: Github Pages Deploy				<span style=color:#75715e># Actions的名称，说明用途</span>

<span style=color:#66d9ef>on</span>:
  push:									<span style=color:#75715e># 在仓库收到push时触发</span>
    <span style=color:#66d9ef>branches</span>:
      - master							<span style=color:#75715e># 指定是master分支收到push时</span>

<span style=color:#66d9ef>jobs</span>:
  <span style=color:#66d9ef>deploy</span>:
    <span style=color:#66d9ef>runs-on</span>: ubuntu<span style=color:#ae81ff>-18.04</span>				<span style=color:#75715e># 所用容器内的操作系统版本</span>
    <span style=color:#66d9ef>steps</span>:
      - <span style=color:#66d9ef>uses</span>: actions/checkout@v2		<span style=color:#75715e># 该action用于将仓库clone到容器内，然后执行一些其他动作</span>
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>submodules</span>: <span style=color:#66d9ef>true</span>  			<span style=color:#75715e># Hugo主题通常以子模块方式添加，需要对子模块进行初始化</span>
          <span style=color:#66d9ef>fetch-depth</span>: <span style=color:#ae81ff>0</span>    			<span style=color:#75715e># 拉取master的所有commit记录，用于Hugo内的.GitInfo</span>

      - <span style=color:#66d9ef>name</span>: Setup Hugo
        <span style=color:#66d9ef>uses</span>: peaceiris/actions-hugo@v2	<span style=color:#75715e># Hugo专用的Actions</span>
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>hugo-version</span>: <span style=color:#e6db74>&#39;0.68.3&#39;</span>		<span style=color:#75715e># 指定所需的Hugo版本，也可以指定为latest</span>
          <span style=color:#66d9ef>extended</span>: <span style=color:#66d9ef>true</span>				<span style=color:#75715e># 使用Hugo extended version，以支持SCSS</span>

      - <span style=color:#66d9ef>name</span>: Build
        <span style=color:#66d9ef>run</span>: hugo --minify				<span style=color:#75715e># 在线进行构建，--minify可减小HTML/CSS/JS文件大小</span>

      - <span style=color:#66d9ef>name</span>: Deploy
        <span style=color:#66d9ef>uses</span>: peaceiris/actions-gh-pages@v3		<span style=color:#75715e># 部署Github Pages所用的Actions</span>
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>deploy_key</span>: ${{ secrets.ghpages }}	<span style=color:#75715e># 详见Troubleshooting一节的说明</span>
          <span style=color:#66d9ef>external_repository</span>: ffffansz/blog	<span style=color:#75715e># 发布到外部仓库blog</span>
          <span style=color:#66d9ef>publish_dir</span>: ./public					<span style=color:#75715e># 发布目录为./public</span>
          <span style=color:#66d9ef>cname</span>: www.libre.fun					<span style=color:#75715e># 自定义域名</span>
</code></pre></div><blockquote class="my-alert my-alert-note"><p>该文件位于<code>blog-src</code>仓库内，请勿混淆。</p></blockquote><p>写好Actions之后，提交更改并推送到<code>blog-src</code>，Github就会根据上述文件，在线进行自动构建和部署。根据服务器的情况，Actions的执行会排队，但是通常等待时间都在十分钟以内。</p><h2 id=小结>小结</h2><p>现在来看看我们到底将博客折腾成了什么样子。</p><p>首先，我们在Github上拥有两个仓库，名称分别为<code>blog</code>和<code>blog-src</code>。</p><p>其中，<code>blog-src</code>存放了我们的网站源码，与Actions文件<code>gh-pages.yml</code>。一般地，我们可以将<code>blog-src</code>仓库clone到本地，在本地对博客的样式和文章进行修改，之后无需在本地构建，直接提交更改然后推送到<code>blog-src</code>，Github Actions会帮助我们在线构建，并将生成的网站内容（仅<code>public</code>目录）推送至<code>blog</code>的<code>gh-pages</code>分支。</p><p>在<code>blog</code>仓库内，具有两个分支，<code>master</code>和<code>gh-pages</code>。其中，<code>master</code>分支可以放置一个README文件和CHANGELOG文件，作为个人Github账户下<code>blog</code>仓库对外展示的一张「名片」；<code>gh-pages</code>分支无需我们手动维护，所有工作都由Github Actions完成。Github Pages的设置也需要在<code>blog</code>仓库内进行，将「Setting」➡「Github Pages」➡「Source」设置为「gh-pages branch」。如有需要，可设置自定义域名。出于安全，强烈建议勾选「Enforce HTTPS」。</p><p>Hope you enjoy it!</p><h2 id=troubleshooting>Troubleshooting</h2><p>本节主要用于答疑。</p><h3 id=如何设置devlop_key>如何设置<code>devlop_key</code></h3><p>在[实现CI/CD](#利用Github Actions实现CI/CD)一节，留了一个细节没有说明。在<code>gh-pages.yml</code>的最后，有一个<code>devlop_key</code>字段：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>      - <span style=color:#66d9ef>name</span>: Deploy
        <span style=color:#66d9ef>uses</span>: peaceiris/actions-gh-pages@v3		<span style=color:#75715e># 部署Github Pages所用的Actions</span>
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>deploy_key</span>: ${{ secrets.ghpages }}	
          <span style=color:#66d9ef>external_repository</span>: ffffansz/blog	<span style=color:#75715e># 发布到外部仓库blog</span>
          <span style=color:#66d9ef>publish_dir</span>: ./public					<span style=color:#75715e># 发布目录为./public</span>
          <span style=color:#66d9ef>cname</span>: www.libre.fun					<span style=color:#75715e># 自定义域名</span>
</code></pre></div><p>简单来讲，Github上的任意两个不同仓库之间，是不具有「A仓库将内容写进B仓库」的权限的。而为了实现跨仓库的自动部署，我们就需要<code>devlop_key</code>来在二者之间建立起具有写权限的关系。</p><p>这一效果的实现其实与使用SSH密钥验证类似。首先，我们需要在本地生成一对密钥，在Linux Bash或者Windows Git Bash中即可操作：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -C gh-pages
</code></pre></div><p>上述命令会生成一对RSA密钥，默认情况下，生成的公钥和私钥文件分别为<code>id_rsa</code>和<code>id_rsa.pub</code>，位于<code>~/.ssh</code>目录下，使用任意文本编辑器打开两个文件，即可看到公私钥的内容。</p><blockquote class="my-alert my-alert-warning"><p>生成密钥时注意选择路径，使用默认路径可能会覆盖你原本使用的SSH密钥。</p></blockquote><p>首先，将私钥添加到<code>blog-src</code>的「Secrets」。在<code>blog-src</code>的「Setting」➡「Secrets」中，「Add a new secrets」：</p><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200424150956.png alt></p><p>Name可任取，但要与<code>gh-pages.yml</code>中<code>devlop_key</code>的值保持一致，此处是<code>ghpages</code>，那么<code>devlop_key</code>的值就应当是<code>${{ secrets.ghpages }}</code>；Value就是私钥<code>id_rsa</code>的内容。</p><p>接着，将公钥添加到<code>blog</code>的「Deploy keys」。在<code>blog</code>的「Setting」➡「Deploy keys」中，「Add devlop key」：</p><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200424151720.png alt></p><p>Title可任取，说明用途即可；Key就是公钥<code>id_rsa.pub</code>的内容。注意需要勾选「Allow write access」复选框，这样才能允许<code>blog-src</code>将内容推送到<code>blog</code>仓库。</p><h3 id=如何迁移>如何迁移</h3><p>如果你之前采用单个<code>blog</code>来存放博客源码和内容，想要实现上述的「分离」。那么为了不丢失博客内容的Commit记录，就需要完整地将原本<code>blog</code>的Git仓库迁移到<code>blog-src</code>，然后清空<code>blog</code>中的内容，只留下README文件。</p><p>迁移过程可以按照以下步骤进行：</p><ol><li><p>将<code>blog</code>仓库的内容clone到本地：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/&lt;username&gt;/blog.git blog
</code></pre></div></li><li><p>在本地的<code>blog</code>目录中，使用<code>git</code>命令修改远端仓库：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd blog
git remote set-url origin https://github.com/&lt;username&gt;/blog-src.git
</code></pre></div></li><li><p>推送到<code>blog-src</code>仓库：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git push -u origin master
</code></pre></div></li><li><p>此时<code>blog</code>和<code>blog-src</code>两个仓库内容完全相同。然后清理<code>blog</code>仓库：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 再次clone，由于只会临时使用，因此本地文件夹命名为tmp</span>
git clone https://github.com/&lt;username&gt;/blog.git tmp
</code></pre></div><p>进入<code>tmp</code>目录，除了<code>README.md</code>保留外，其余内容全部删除。这里建议也一并删除<code>.git</code>目录，由于源码及其提交记录已迁移至<code>blog-src</code>仓库，因此保留<code>blog</code>仓库中的提交记录也没有太大意义。</p><p>然后将<code>tmp</code>目录推送至<code>blog</code>仓库：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 如果删除了.git目录，则还需执行git init来初始化新的git仓库</span>
git init
git add .
git commit -m <span style=color:#e6db74>&#34;Initial commit&#34;</span>
git remote add origin https://github.com/&lt;username&gt;/blog.git
git push -fu origin master
<span style=color:#75715e># 由于清空了.git目录，因此必须加上-f来强制推送</span>
</code></pre></div><p>随后删除<code>tmp</code>目录即可。考虑到<code>blog</code>仓库的<code>master</code>分支仅用于展示，所以需要修改时可以直接在Github仓库主页进行，无须在本地维护。</p></li></ol><h3 id=私有仓库和github-actions的使用有何限制>私有仓库和Github Actions的使用有何限制</h3><p>本文写作于2020年4月24日，此时，Github的服务政策是：</p><ul><li>私有仓库：任何人均可使用，数量不限。且前不久，Github还放开了私有仓库协作者（Collaborators）的数量限制，之前是3人/仓库，现在不限人数，对团队维护的项目更加友好。</li><li>Github Actions：对于「Free」订阅的用户，即从未付过任何费用的用户，账户每月Github Actions的运行时间数为2000分钟；对于「Pro」订阅，为3000分钟。我个人是通过「<a href=https://education.github.com/pack#offers>GitHub Student Developer Pack</a>」获取了「Pro」订阅，使用教育邮箱即可验证。即使是「Free」订阅的2000分钟，对于一般的个人博客而言也已足够，特别是本站使用的Hugo，构建速度很快，不会在Actions上花费太多时间。</li></ul><h3 id=其他>其他</h3><p>其他关于搭建个人博客的流程，可参阅我的上一篇文章<a href=/posts/build-site-with-hugo-and-github-pages/>Hugo & Github Pages 建站过程全记录</a>。</p></div></div><nav class=post-pagination><div class=newer-posts>已是最新一篇了。</div><div class=older-posts>旧文 :<br><a href=https://www.libre.fun/posts/build-site-with-hugo-and-github-pages/>Hugo & Github Pages 建站过程全记录</a></div></nav><div class=post-comment-wrapper><div id=gitalk-container></div></div></div></div></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://amazingrise.net>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal</a><br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> and <a href=https://pages.github.com/ target=_blank>Github Pages</a><br><br>&copy;
Libre. 本站遵循 CC-BY-NC 4.0 协议<br><a href=https://github.com/ffffansz/blog/blob/master/CHANGELOG.md target=_blank>CHANGELOG</a></div></div><script src=https://www.libre.fun//js/journal.js></script></body></html>