<!doctype html><html><head><title>Hugo & Github Pages 建站过程全记录&nbsp;- Libre's Blog</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script src=/vendor/js/jquery.min.js></script><script src=/vendor/js/popper.min.js></script><script src=/vendor/js/bootstrap.min.js></script><script src=/vendor/js/smooth-scroll.polyfills.min.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><script src=/vendor/js/vue.min.js></script><link rel=stylesheet href=https://blog.libre.fun/scss/journal.min.8650853483769a2c86962bebf88e58771fef8dc8b1690fe91be762e7a85085f6.css integrity="sha256-hlCFNIN2miyGlivr+I5Ydx/vjcixaQ/pG+di56hQhfY=" media=screen><script src=https://blog.libre.fun//js/loadCSS.js></script><script src=https://blog.libre.fun//js/table.js></script><script src=https://blog.libre.fun//js/toc.js></script><script>loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script src=/vendor/js/md5.min.js></script><script>const gitalk=new Gitalk({clientID:'76eb2ff425beb8b7d1e2',clientSecret:'8c86c664d1d2dc6034544b9b679a19bd3507a84d',repo:'blog',owner:'ffffansz',admin:['ffffansz'],id:md5(location.pathname),});window.onload=function(){gitalk.render('gitalk-container')}</script></head><body><div id=app><div ref=sideContainer class=side-container><a class="a-block nav-head false" href=https://blog.libre.fun/><div class=nav-title>Libre's Blog</div><div class=nav-subtitle>理想是，以代码安身，以文字立命</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>文章</a>
<a class="a-block nav-link-item false" href=/tags>标签</a>
<a class="a-block nav-link-item false" href=/about>关于</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://amazingrise.net>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal</a><br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> and <a href=https://pages.github.com/ target=_blank>Github Pages</a><br><br>&copy;
Libre. 本站遵循 CC-BY-NC 4.0 协议<br><a href=https://github.com/ffffansz/blog/blob/master/CHANGELOG.md target=_blank>CHANGELOG</a></div></div><div ref=extraContainer class=extra-container><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e6%95%b4%e4%bd%93%e6%ad%a5%e9%aa%a4 v-on:click=closeDrawer id=整体步骤-nav>整体步骤</a></li></ul></ul><ul><ul><li><a href=#git%e4%bd%bf%e7%94%a8%e8%a7%84%e8%8c%83 v-on:click=closeDrawer id=git使用规范-nav>Git使用规范</a></li></ul></ul><ul><ul><li><a href=#%e5%b7%a5%e5%85%b7%e5%87%86%e5%a4%87 v-on:click=closeDrawer id=工具准备-nav>工具准备</a></li></ul></ul><ul><ul><li><a href=#%e9%a1%b9%e7%9b%ae%e5%88%9d%e5%a7%8b%e5%8c%96 v-on:click=closeDrawer id=项目初始化-nav>项目初始化</a></li></ul></ul><ul><ul><li><a href=#%e6%b7%bb%e5%8a%a0%e4%b8%bb%e9%a2%98 v-on:click=closeDrawer id=添加主题-nav>添加主题</a></li></ul></ul><ul><ul><li><a href=#%e6%b7%bb%e5%8a%a0%e5%86%85%e5%ae%b9 v-on:click=closeDrawer id=添加内容-nav>添加内容</a></li></ul></ul><ul><ul><li><a href=#%e4%b8%bb%e9%a2%98%e5%ae%9a%e5%88%b6%e4%b8%8e%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88 v-on:click=closeDrawer id=主题定制与本地预览-nav>主题定制与本地预览</a></li></ul></ul><ul><ul><ul><li><a href=#%e9%a2%84%e8%a7%88%e4%b8%bb%e9%a2%98%e7%a4%ba%e4%be%8b%e7%bd%91%e7%ab%99 v-on:click=closeDrawer id=预览主题示例网站-nav>预览主题示例网站</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e4%b8%bb%e9%a2%98%e5%ae%9a%e5%88%b6 v-on:click=closeDrawer id=主题定制-nav>主题定制</a></li></ul></ul></ul><ul><ul><li><a href=#%e5%8f%91%e5%b8%83%e5%88%b0github-pages v-on:click=closeDrawer id=发布到github-pages-nav>发布到Github Pages</a></li></ul></ul><ul><ul><ul><li><a href=#cicd-workflow v-on:click=closeDrawer id=cicd-workflow-nav>CI/CD Workflow</a></li></ul></ul></ul><ul><ul><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9f%9f%e5%90%8d%e5%8f%8ahttps v-on:click=closeDrawer id=自定义域名及https-nav>自定义域名及HTTPS</a></li></ul></ul><ul><ul><ul><li><a href=#cicd-%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9f%9f%e5%90%8d%e8%ae%be%e7%bd%ae v-on:click=closeDrawer id=cicd-自定义域名设置-nav>CI/CD 自定义域名设置</a></li></ul></ul></ul><ul><ul><li><a href=#%e5%b0%8f%e7%bb%93 v-on:click=closeDrawer id=小结-nav>小结</a></li></ul></ul></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a></div></div><div class=single-column-drawer-container ref=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>文章</a>
<a class="a-block drawer-menu-item false" href=/tags>标签</a>
<a class="a-block drawer-menu-item false" href=/about>关于</a><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e6%95%b4%e4%bd%93%e6%ad%a5%e9%aa%a4 v-on:click=closeDrawer id=整体步骤-nav>整体步骤</a></li></ul></ul><ul><ul><li><a href=#git%e4%bd%bf%e7%94%a8%e8%a7%84%e8%8c%83 v-on:click=closeDrawer id=git使用规范-nav>Git使用规范</a></li></ul></ul><ul><ul><li><a href=#%e5%b7%a5%e5%85%b7%e5%87%86%e5%a4%87 v-on:click=closeDrawer id=工具准备-nav>工具准备</a></li></ul></ul><ul><ul><li><a href=#%e9%a1%b9%e7%9b%ae%e5%88%9d%e5%a7%8b%e5%8c%96 v-on:click=closeDrawer id=项目初始化-nav>项目初始化</a></li></ul></ul><ul><ul><li><a href=#%e6%b7%bb%e5%8a%a0%e4%b8%bb%e9%a2%98 v-on:click=closeDrawer id=添加主题-nav>添加主题</a></li></ul></ul><ul><ul><li><a href=#%e6%b7%bb%e5%8a%a0%e5%86%85%e5%ae%b9 v-on:click=closeDrawer id=添加内容-nav>添加内容</a></li></ul></ul><ul><ul><li><a href=#%e4%b8%bb%e9%a2%98%e5%ae%9a%e5%88%b6%e4%b8%8e%e6%9c%ac%e5%9c%b0%e9%a2%84%e8%a7%88 v-on:click=closeDrawer id=主题定制与本地预览-nav>主题定制与本地预览</a></li></ul></ul><ul><ul><ul><li><a href=#%e9%a2%84%e8%a7%88%e4%b8%bb%e9%a2%98%e7%a4%ba%e4%be%8b%e7%bd%91%e7%ab%99 v-on:click=closeDrawer id=预览主题示例网站-nav>预览主题示例网站</a></li></ul></ul></ul><ul><ul><ul><li><a href=#%e4%b8%bb%e9%a2%98%e5%ae%9a%e5%88%b6 v-on:click=closeDrawer id=主题定制-nav>主题定制</a></li></ul></ul></ul><ul><ul><li><a href=#%e5%8f%91%e5%b8%83%e5%88%b0github-pages v-on:click=closeDrawer id=发布到github-pages-nav>发布到Github Pages</a></li></ul></ul><ul><ul><ul><li><a href=#cicd-workflow v-on:click=closeDrawer id=cicd-workflow-nav>CI/CD Workflow</a></li></ul></ul></ul><ul><ul><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9f%9f%e5%90%8d%e5%8f%8ahttps v-on:click=closeDrawer id=自定义域名及https-nav>自定义域名及HTTPS</a></li></ul></ul><ul><ul><ul><li><a href=#cicd-%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9f%9f%e5%90%8d%e8%ae%be%e7%bd%ae v-on:click=closeDrawer id=cicd-自定义域名设置-nav>CI/CD 自定义域名设置</a></li></ul></ul></ul><ul><ul><li><a href=#%e5%b0%8f%e7%bb%93 v-on:click=closeDrawer id=小结-nav>小结</a></li></ul></ul></div></div></div></div></div><transition name=fade><div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav ref=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div ref=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a ref=navTitle class=navbar-brand href=https://blog.libre.fun/>Libre's Blog</a></div></nav><div class=single-column-header-container ref=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://blog.libre.fun/><div class=single-column-header-title>Libre's Blog</div><div class=single-column-header-subtitle>理想是，以代码安身，以文字立命</div></a></div><div id=content><div ref=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only style="background-image:url('/')"><div class=post-title>Hugo & Github Pages 建站过程全记录<div class=post-meta><time itemprop=datePublished>2020/04/12 02:55</time>
<i class=material-icons>label</i>&nbsp;<a href=/tags/blog>Blog</a>&nbsp;&#183;&nbsp;<a href=/tags/hugo>Hugo</a></div></div></div><div class=post-body-wrapper><div class=post-body><h2 id=整体步骤>整体步骤</h2><p>之前也使用Hugo搭建过几次个人博客，但是由于各种各样的问题始终不甚满意，未能持续运行。这次再从头搭建一次，力求将各种细节都做到让自己满意。</p><p>博客搭建的整体步骤如下：</p><ol><li><p>从<code>hugo new site</code>建立的空项目开始，逐步添加内容。项目根路径记为<code>Site</code></p></li><li><p>在项目目录下建立Git仓库，然后Push到Github，Github上对应的仓库名为<code>blog</code></p></li><li><p>主题使用Git的子模块（Submodule）功能进行管理</p></li><li><p>修改主题时，不去修改主题子模块本身的文件，而是将对应的样式文件、HTML或JS文件SCSS或HTML文件复制到<code>Site</code>目录下对应的目录再进行修改。由于Hugo的样式查找策略，会使用<code>Site</code>下的样式文件去替代<code>themes/&lt;theme-name></code>下的样式文件。</p><blockquote><p>这么做主要是考虑到主题后续还会更新，其样式文件会发生变化。Submodule功能可以指定子模块的某次commit作为主项目使用的版本，更新与否取决于主项目是否想要使用新的版本。</p></blockquote></li><li><p>网站使用Github Pages发布，操作方式是在<code>blog</code>仓库中创建<code>gh-pages</code>分支，之后在仓库Setting页设置Source即可</p></li><li><p>使用自定义域名</p></li><li><p>利用Github Actions实现CI/CD，只需在本地<code>master</code>分支修改网站源码、添加博客内容，之后将<code>master</code>分支推送至Github即可，网站的生成和部署都由Github Actions完成。</p></li></ol><p>接下来是对建站过程的一个记录，途中碰到的问题也会一并记录下来。</p><h2 id=git使用规范>Git使用规范</h2><p>之前使用Git的时候，自己有一个不好的习惯是修改一堆东西之后Commit一次，这样一来不但Commit Message不好写，而且版本管理也是一团糟，不利于版本回顾。</p><p>所以这次强迫自己，<strong>所有修改以功能点为单位，修改完一个点就Commit一次。</strong></p><p>举个例子，假设我现在需要做两件事：(1) 修改文章标签的样式，(2) 修改Footer处的Copy Right。那么每做一件事，就Commit一次，并写清楚对应的Commit Message。</p><p>多说一句，Git的功能非常强大，使用得当可以节省大量的时间。Git入门我推荐<a href=https://www.liaoxuefeng.com/wiki/896043488029600>廖雪峰的Git教程</a>，浅显易懂。我个人对Git的掌握也非常粗浅，只能通过不断地实践来熟悉它了。</p><h2 id=工具准备>工具准备</h2><p>本次搭建的是一个静态网站，使用的工具包括静态网站生成器Hugo、Git、Github Pages，以及一个基本的代码编辑器，推荐VSCode。使用的操作系统为Windows 10。</p><ol><li>在<a href=https://github.com/gohugoio/hugo/releases>Hugo - Github</a>下载最新的Release，注意extended版本才支持SCSS样式文件；平台是Windows，所以这里选择下载<a href=https://github.com/gohugoio/hugo/releases/download/v0.68.3/hugo_extended_0.68.3_Windows-64bit.zip>hugo_extended_0.68.3_Windows-64bit.zip</a>；解压后得到<code>hugo.exe</code>文件，在D盘下建立文件夹<code>Hugo</code>，将<code>hugo.exe</code>放入（即<code>D:\Hugo\hugo.exe</code>）。然后在「环境变量」→「系统变量」→<code>Path</code>中添加<code>D:\Hugo</code>，即可在终端（CMD、Powershell、VSCode Terminal）中使用<code>hugo</code>命令。</li><li>在<a href=https://git-scm.com/downloads>Git Downloads</a>中下载Windows版本的Git安装包，本文写作时的版本是2.26.0，有一大堆安装选项，之后有空的话我再写一篇文章专门解释各个选项的意思。#TODO</li><li>Github Pages是Github推出的一项免费托管服务，可以根据Github仓库内的文件将其转换为可直接访问的网站，域名是<code>&lt;github-username>.github.io</code>，也可以自定义域名。只需拥有一个Github账号即可使用该功能。</li></ol><p>下文的所有命令，均在VSCode Terminal内执行（实质就是在VSCode内调用了Windows内置的Powershell）。</p><h2 id=项目初始化>项目初始化</h2><p>首先在Github上建立一个新仓库，名为<code>blog</code>，用于托管本次网站项目的源码。</p><p>接着在某个本地目录下操作，这里我选择了D盘根路径：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>cd D:\
git clone https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/ffffansz/blog.git Site
</code></pre></div><p>这样我们的<code>Site</code>文件夹在本地的绝对路径就是<code>D:\Site</code>。</p><p>在<code>Site</code>下添加<code>README.md</code>文件，简述该仓库的用途：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e># Blog</span>

My personal site, powered by <span style=color:#66d9ef>[Hugo]</span>(https<span style=color:#960050;background-color:#1e0010>:</span>//gohugo.io) &amp; [hugo-theme-diary](https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/AmazingRise/hugo-theme-diary).

Hosted on Github Pages <span style=color:#66d9ef>for</span> now.

Welcome to visit it! <span style=color:#960050;background-color:#1e0010>😊</span>

<span style=color:#66d9ef>[Libre]</span>(https<span style=color:#960050;background-color:#1e0010>:</span>//libre.fun)
</code></pre></div><p>然后在<code>D:\Site\</code>目录下使用Hugo命令创建新站点：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>cd D:\Site
hugo new site .
</code></pre></div><p>会发现<code>Site</code>目录内生成了如下的项目结构：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#960050;background-color:#1e0010>├─</span>archetypes
<span style=color:#960050;background-color:#1e0010>├─</span>content
<span style=color:#960050;background-color:#1e0010>├─</span>data
<span style=color:#960050;background-color:#1e0010>├─</span>layouts
<span style=color:#960050;background-color:#1e0010>├─</span>static
<span style=color:#960050;background-color:#1e0010>└─</span>themes
</code></pre></div><p>使用Git命令提交项目的更改，并推送到Github：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>cd D:\Site
git add .
git commit -m <span style=color:#e6db74>&#34;first commit&#34;</span>
git push -u origin master
</code></pre></div><p>至此，初始化工作就完成了。</p><h2 id=添加主题>添加主题</h2><p>接下来利用Git Submodule功能添加主题。</p><p>Git Submodule简单来讲，就是在一个Git仓库中嵌套另一个Git仓库。以本网站为例，<code>D:\Site</code>是一个Git仓库，而即将要添加的主题通常也是一个Git仓库，二者是嵌套关系。在Git的文档中，主仓库被称为SuperProject，本文中指的就是网站项目本身，主题则作为一个Submodule，可在SuperProject中使用<code>git submodule</code>命令统一管理。</p><blockquote><p>当然，也可以直接下载主题文件并放进<code>Site/themes</code>目录下。但是Hugo官方推荐以Submodule来管理主题。个人认为这样做的好处是方便主题的更新。</p></blockquote><p>首先我们在<a href=https://themes.gohugo.io/>Hugo Theme</a>挑选一个中意的主题，这里我选择了<a href=https://github.com/AmazingRise/hugo-theme-diary>hugo-theme-diary</a>。</p><p>使用<code>git submodule</code>命令将其添加为主题，并更新：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>cd D:\Site
git submodule add https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/AmazingRise/hugo-theme-diary.git themes/diary
git submodule update --init --remote
</code></pre></div><p>完成后提交更改：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>git add .
git commit -m <span style=color:#e6db74>&#34;add submodule themes/diary&#34;</span>
</code></pre></div><h2 id=添加内容>添加内容</h2><p>在Hugo中，所有的内容文件都放在<code>content</code>目录下。对于个人博客，一般的做法是，在<code>content</code>下建立<code>posts</code>文件夹，然后往内放入博客文章的Markdown文件。</p><p>这里需要说明，不同主题对于内容文件放置的方式可能有不同的规定，对于本文使用的<code>diary</code>主题以及大部分Hugo主题来说，上面提到的方式就是符合规范的。其他主题适用的放置方式则可以参考主题本身的说明或是主题源码下的<code>exampleSite/content</code>目录。</p><h2 id=主题定制与本地预览>主题定制与本地预览</h2><p>接下来对网站主题进行定制，将其修改为自己喜欢的样式。</p><blockquote><p>不同主题的样式文件组织不同，因此这一部分并不适用于所有主题。</p></blockquote><p>对主题进行定制有两种方式：</p><ol><li>一种是按照主题作者给出的设置项，修改网站根目录下<code>config.toml</code>中的参数项，进行简单的功能配置。此项一般能够满足大部分人对网站主题的需求。</li><li>直接对CSS/SCSS样式文件、HTML模板和JS脚本进行修改。此项要求对Hugo模板（Template）和Web前端有了解。Hugo模板的技术细节需要阅读Hugo的<a href=https://gohugo.io/documentation/>官方文档</a>，CSS/SCSS、JS则可以在网上找一些教程进行入门。</li></ol><h3 id=预览主题示例网站>预览主题示例网站</h3><p>这里我们首先对主题进行预览。所有的Hugo主题都有一个<code>exampleSite</code>文件夹，在本项目中，该文件夹的路径为<code>D:\Site\themes\diary\exampleSite</code>。通过以下命令，使用Hugo构建网站并启动本地服务器：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>cd D:\Site\themes\diary\exampleSite
hugo server --themesDir ../..

<span style=color:#75715e># 以下为命令输出：</span>
Building sites <span style=color:#960050;background-color:#1e0010>…</span> 
                   | EN  
-------------------+-----
  Pages            | 31
  Paginator pages  |  0
  Non-page files   |  0
  Static files     | 20
  Processed images |  0
  Aliases          | 13
  Sitemaps         |  1
  Cleaned          |  0

Built <span style=color:#66d9ef>in</span> 48 ms
Watching <span style=color:#66d9ef>for</span> changes <span style=color:#66d9ef>in</span> D:\Blog\Site\themes\diary\{archetypes,assets,exampleSite,layouts,static}
Watching <span style=color:#66d9ef>for</span> config changes <span style=color:#66d9ef>in</span> D:\Blog\Site\themes\diary\exampleSite\config.toml
Environment<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;development&#34;</span>
Serving pages from memory
Running <span style=color:#66d9ef>in</span> Fast Render Mode. <span style=color:#66d9ef>For</span> full rebuilds on change<span style=color:#960050;background-color:#1e0010>:</span> hugo server --disableFastRender
Web Server is available at http<span style=color:#960050;background-color:#1e0010>:</span>//localhost<span style=color:#960050;background-color:#1e0010>:</span>1313/ (bind address 127.0.0.1)
Press Ctrl+C to stop
</code></pre></div><p>可以看到网站已经运行在了<code>localhost:1313</code>上，打开浏览器输入<code>localhost:1313</code>即可看到本地运行的网站。</p><blockquote><p>注意，此时预览的是由主题作者提供的示例网站，配置文件使用了<code>exampleSite\config.toml</code>，内容文件使用了<code>exampleSite\content</code>。当你为自己的网站添加了内容和配置文件后，则需要在网站的根目录下执行<code>hugo server</code>命令。</p></blockquote><h3 id=主题定制>主题定制</h3><p>由于这部分并不通用，所以我只会简单记载所做的修改。<a href=https://github.com/AmazingRise/hugo-theme-diary>hugo-theme-diary</a>可在<code>config.toml</code>中配置一些基本功能模块，教程位于其Github仓库的Wiki中。</p><p>从初始化仓库到写作本文时，我总共进行了42次Commit，主要内容会写在网站的<a href=https://github.com/ffffansz/blog/blob/master/CHANGELOG.md>CHANGELOG</a>中。</p><h2 id=发布到github-pages>发布到Github Pages</h2><p>Github Pages是Github提供的免费静态网站托管服务。如果你的网站访问量较低，且没有其他服务器方面的需求，那么利用Github Pages来建立一个自己的个人网站是非常合适的选择。</p><p>以前，Github Pages还要求仓库名必须为<code>&lt;username>.github.io</code>的形式，不知道什么时候起就取消了这项规定，任何仓库名都可以被用来创建Github Pages。</p><p>正常情况下，在本地完成对网站内容或样式的编辑后，在<code>Site</code>路径下执行<code>hugo</code>命令，会生成<code>Site/public</code>目录，该目录就是你的网站文件。然后使用<code>git commit</code>和<code>git push</code>命令，即可将网站源码和网站文件一起推送到Github仓库的master分支下。</p><p>但是这个方式，着实不太优雅，不但每次都需要手工构建网站（执行<code>hugo</code>命令），而且源码还和编译结果搅和在一起。况且，Github Pages仅支持仓库根目录下以<code>docs</code>命名的目录作为发布目录，Hugo生成的<code>public</code>目录还需改名才能使用，更是麻烦。</p><p>因此这里我们借助Github Actions的功能，在master分支push后自动构建网站，并将构建结果（<code>public</code>目录）发布到单独的<code>gh-pages</code>分支。随后我们只需在仓库的Setting页面设置Github Pages使用<code>gh-pages</code>分支来作为发布源即可，如下图：</p><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200412000129.png alt></p><h3 id=cicd-workflow>CI/CD Workflow</h3><p>上文所述的这类自动构建、部署的流程也被称为CI/CD。Github Actions就正好可以完成这一工作。</p><p>前文提到，一旦Github Pages发布成功，网站即可通过<code>&lt;username>.github.io</code>来访问。因此，在制作CI/CD工作流前，我们首先需要在<code>config.toml</code>内修改<code>baseURL</code>的值：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=color:#a6e22e>baseURL</span> = <span style=color:#e6db74>&#34;https://&lt;username&gt;.github.io/&#34;</span>
<span style=color:#75715e># 需要将&lt;username&gt;替换成你自己的Github账户名</span>
<span style=color:#75715e># other params ...</span>
</code></pre></div><p>接下来才是利用Github Actions建立CI/CD工作流的过程。</p><p>首先需要在<code>Site</code>目录下建立<code>.github/workflows/</code>目录，然后在<code>workflows</code>目录下建立一个<code>gh-pages.yml</code>的文件。</p><blockquote class="my-alert my-alert-warning"><p><p>不要忽略<code>.github</code>前面的<code>.</code>；</p><p><code>gh-pages.yml</code>的路径为<code>Site/.github/workflows/gh-pages.yml</code></p></p></blockquote><p>然后在<code>gh-pages.yml</code>中写入如下内容（基于写作时最新版<a href=https://github.com/peaceiris/actions-gh-pages>actions-gh-pages</a>的Hugo示例修改而来）：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>name</span>: Github Pages Deploy

<span style=color:#66d9ef>on</span>:
  <span style=color:#66d9ef>push</span>:
    <span style=color:#66d9ef>branches</span>:
      - master

<span style=color:#66d9ef>jobs</span>:
  <span style=color:#66d9ef>deploy</span>:
    <span style=color:#66d9ef>runs-on</span>: ubuntu<span style=color:#ae81ff>-18.04</span>
    <span style=color:#66d9ef>steps</span>:
      - <span style=color:#66d9ef>uses</span>: actions/checkout@v2
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>submodules</span>: <span style=color:#66d9ef>true</span>  <span style=color:#75715e># Fetch submodule Hugo themes</span>
          <span style=color:#66d9ef>fetch-depth</span>: <span style=color:#ae81ff>0</span>    <span style=color:#75715e># Fetch all commit history for .GitInfo and .Lastmod</span>

      - <span style=color:#66d9ef>name</span>: Setup Hugo
        <span style=color:#66d9ef>uses</span>: peaceiris/actions-hugo@v2
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>hugo-version</span>: <span style=color:#e6db74>&#39;0.68.3&#39;</span>
          <span style=color:#66d9ef>extended</span>: <span style=color:#66d9ef>true</span>

      - <span style=color:#66d9ef>name</span>: Build
        <span style=color:#66d9ef>run</span>: hugo --minify

      - <span style=color:#66d9ef>name</span>: Deploy
        <span style=color:#66d9ef>uses</span>: peaceiris/actions-gh-pages@v3
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>github_token</span>: ${{ secrets.GITHUB_TOKEN }}
          <span style=color:#66d9ef>publish_dir</span>: ./public
</code></pre></div><p>完成后，Commit并Push到Github，然后去Setting页面，将Github Pages的Source设置为<code>gh-pages</code>即可。</p><p>Push后在仓库主页确认你的Actions执行状态：</p><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200412002223.png alt></p><p>黄色圆点表示正在执行或排队等待，<strong>绿色对勾表示执行完成</strong>，红色叉则表示构建出错，需要手动查看一下出错原因。个别时候是因为玄学问题，Re-Run一下即可，大部分时候还是网站源码本身存在错误，建议在本地执行<code>hugo</code>排查错误。</p><p>如果一切顺利，等待几分钟，访问<code>&lt;username>.github.io</code>就能看到你的个人网站了。</p><h2 id=自定义域名及https>自定义域名及HTTPS</h2><p>最后，个人网站怎么能没有一个具有个人特色的域名呢。当你拥有自己的域名之后，就可以将其用在由Github Pages托管的个人网站上。</p><p>首先我们来明确最终要达到的效果。我拥有<code>libre.fun</code>这个域名，想将其作为我个人主页的域名。并且，无论是输入<code>www.libre.fun</code>还是<code>libre.fun</code>都能正常访问网站。最后，出于安全和浏览器兼容性考虑，为网站设置HTTPS。</p><blockquote><p>主流浏览器目前都会给HTTP网站打上“不安全”的标记，例如Chrome。</p></blockquote><p>设置的时候我也参考了网上不少的中文博客，但是很少有能把自定义域名这个过程讲清楚的，所以最后直接参照了Github Pages官方的帮助文档。</p><p>要实现上面所说的效果，需要进行以下几个步骤：</p><ol><li><p>在<code>config.toml</code>中修改<code>baseURL</code>，这里我们改为带<code>www</code>前缀的<code>https://www.libre.fun/</code></p></li><li><p>在DNS提供商处添加解析记录。这一步最不容易理解，我们一步一步来讲。</p><p>以我的域名<code>libre.fun</code>为例，我是在Namecheap购买的，然后购买了腾讯云DNSPod个人专业版云解析服务来进行DNS解析。</p><p>首先，按照DNSPod的提示，在Namecheap上修改<code>libre.fun</code>的DNS：</p><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200412021814.png alt></p><blockquote><p>如果是其他DNS解析服务，DNS地址可能会有所不同。DNSPod免费版、个人专业版的DNS地址也会不同。具体以DNS服务提供商给出的提示为准。</p><p>多说一句，DNSPod个人专业版经常会有促销活动，6元/年，非常划算。</p></blockquote><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200412021901.png alt></p><blockquote><p>在域名注册商处修改完成后，通常需要等待一段时间，DNS服务提供商那里才会显示解析正常。</p></blockquote><p>等到DNSPod显示解析正常后，在解析管理处，添加如下的解析记录：</p><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200412022410.png alt></p><p>可以看到，图中总共有五个解析记录，四个A类型，一个CNAME类型。那么这些记录都是什么意思呢？</p><p>简单来说，<strong>四个主机记录为@的A类型记录</strong>，是将<code>libre.fun</code>这个地址解析到了四个不同的IP地址上，而这四个IP地址，都是Github Pages提供服务的IP地址，其出处是Github Pages的官方文档：<a href=https://help.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site>Managing a custom domain for your GitHub Pages site</a>。</p><p>而主机记录为www的CNAME记录，则是将<code>www.libre.fun</code>指向了<code>ffffansz.github.io</code>这个默认域名，再由<code>ffffansz.github.io</code>来提供IP地址。</p></li><li><p>在<code>blog</code>仓库的Setting页，将Github Pages的Custom Domain设置为<code>www.libre.fun</code></p><blockquote><p>一定要是带www前缀的，否则会出现问题。</p></blockquote></li><li><p>等待一小会后，勾选「Enforce HTTPS」。</p><p><img src=https://image-hosting-1251771285.cos.ap-guangzhou.myqcloud.com/20200412023430.png alt></p></li></ol><p>如果你严格按照上述步骤操作，没有在哪里该添加、哪里不该添加<code>www</code>前缀的问题上出错，那么几分钟后，无论是带还是不带<code>www</code>的个人域名，都可以用来访问你的个人主页了。</p><p>注意，如果没有按照上述步骤操作，你可能会遇到以下问题中的某个或多个：</p><ul><li><code>libre.fun</code>或<code>www.libre.fun</code>其中一个地址打开会出现404</li><li>进入网站后发现网页只有文字和链接，网页样式丢失，按下F12，Console的报错信息与CORS相关：<ul><li>可能是<code>libre.fun</code>和<code>www.libre.fun</code>之间的CORS问题</li><li>也可能是<code>http://</code>和<code>https://</code>之间的CORS问题</li></ul></li></ul><p>这些都说明你在某个步骤上参数设置有问题，请对照步骤重新检查。</p><h3 id=cicd-自定义域名设置>CI/CD 自定义域名设置</h3><p>按照上述方式配置后，网站便能够以<code>libre.fun</code>或<code>www.libre.fun</code>来访问。但是如果你在本地修改了网站源码或内容，再次Push后，会发现地址失效了。这是因为Github Pages Setting是通过在<code>gh-pages</code>根目录下放置CNAME文件来实现自定义域名的。而每次Push，会导致重新生成<code>gh-pages</code>的文件，原本的CNAME也就不复存在。</p><p>因此我们还需要在<code>.github/workflows/gh-pages.yml</code>中做一些小修改。在文件最后加上一个<code>cname</code>项即可：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># ...</span>
      - <span style=color:#66d9ef>name</span>: Deploy
        <span style=color:#66d9ef>uses</span>: peaceiris/actions-gh-pages@v3
        <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>github_token</span>: ${{ secrets.GITHUB_TOKEN }}
          <span style=color:#66d9ef>publish_dir</span>: ./public
          <span style=color:#66d9ef>cname</span>: www.libre.fun
</code></pre></div><blockquote class="my-alert my-alert-note"><p>仍然是带<code>www</code>前缀的域名。</p></blockquote><h2 id=小结>小结</h2><p>至此，一个基于Hugo，托管在Github Pages，且带有自动化CI/CD的静态个人网站就完成了。而且，经过一系列配置，网站使用HTTPS协议，可通过自定义域名访问（带不带<code>www</code>前缀都可以）。</p><p>之后的工作就是不断地完善自己的网站，添加更多的博客文章，并且在原主题更新的基础上，自己对主题进行定制，根据自己的需要，开启或关闭、添加或删除网站的某些功能。</p><p>希望这篇文章能给打算自己建站的人带来帮助。</p></div></div><nav class=post-pagination><div class=newer-posts>已是最新一篇了。</div><div class=older-posts>旧文 :<br><a href=https://blog.libre.fun/posts/setup-startup-in-wsl/>WSL 设置开机启动项</a></div></nav><div class=post-comment-wrapper><div id=gitalk-container></div></div></div></div></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://amazingrise.net>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal</a><br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> and <a href=https://pages.github.com/ target=_blank>Github Pages</a><br><br>&copy;
Libre. 本站遵循 CC-BY-NC 4.0 协议<br><a href=https://github.com/ffffansz/blog/blob/master/CHANGELOG.md target=_blank>CHANGELOG</a></div></div><script src=https://blog.libre.fun//js/journal.js></script></body></html>